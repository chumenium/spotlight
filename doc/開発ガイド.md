# SpotLight 開発ガイド

このドキュメントでは、SpotLightアプリの開発環境構築、コーディング規約、デバッグ方法について説明します。

## 開発環境

### 必要なツール
- **Flutter SDK**: 3.0以上
- **Dart SDK**: 3.0以上
- **Android Studio**: 最新版
- **VS Code**: Flutter拡張機能付き
- **Git**: バージョン管理

### 環境構築手順
1. Flutter SDKのインストール
2. Android Studioのセットアップ
3. エミュレータの設定
4. プロジェクトのクローン
5. 依存関係のインストール

```bash
# プロジェクトのクローン
git clone https://github.com/chumenium/spotlight.git
cd spotlight

# 依存関係のインストール
flutter pub get

# アプリの実行
flutter run
```

## プロジェクト構造

```
lib/
├── main.dart                 # アプリのエントリーポイント
├── models/                   # データモデル
│   ├── post.dart            # 投稿データモデル
│   └── search_history.dart  # 検索履歴データモデル
├── providers/               # 状態管理
│   └── navigation_provider.dart
├── screens/                 # 画面
│   ├── home_screen.dart     # ホーム画面
│   ├── search_screen.dart   # 検索画面
│   ├── create_post_screen.dart
│   ├── notifications_screen.dart
│   ├── profile_screen.dart
│   ├── history_list_screen.dart
│   ├── playlist_list_screen.dart
│   └── spotlight_list_screen.dart
├── widgets/                 # 再利用可能なウィジェット
│   └── bottom_navigation_bar.dart
└── utils/                   # ユーティリティ
    └── spotlight_colors.dart
```

## コーディング規約

### ファイル命名規則
- **ファイル名**: snake_case
- **クラス名**: PascalCase
- **変数名**: camelCase
- **定数名**: UPPER_SNAKE_CASE

### コード構造
```dart
// インポート文
import 'package:flutter/material.dart';

// クラス定義
class ExampleWidget extends StatefulWidget {
  const ExampleWidget({super.key});

  @override
  State<ExampleWidget> createState() => _ExampleWidgetState();
}

class _ExampleWidgetState extends State<ExampleWidget> {
  // プライベート変数
  late AnimationController _controller;
  
  @override
  void initState() {
    super.initState();
    // 初期化処理
  }

  @override
  void dispose() {
    // リソースの解放
    _controller.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      // UI構築
    );
  }
}
```

### コメント規約
```dart
/// クラスやメソッドの説明
/// 
/// 詳細な説明があれば記載
class ExampleClass {
  /// メソッドの説明
  /// 
  /// [parameter] パラメータの説明
  /// 戻り値の説明
  void exampleMethod(String parameter) {
    // インラインコメント
  }
}
```

## 状態管理

### Provider使用例
```dart
// Provider定義
class NavigationProvider extends ChangeNotifier {
  int _currentIndex = 0;
  
  int get currentIndex => _currentIndex;
  
  void setCurrentIndex(int index) {
    if (_currentIndex != index) {
      _currentIndex = index;
      notifyListeners();
    }
  }
}

// 使用例
Consumer<NavigationProvider>(
  builder: (context, navigationProvider, _) {
    return Text('Current Index: ${navigationProvider.currentIndex}');
  },
)
```

## アニメーション実装

### AnimationController使用例
```dart
class _ExampleState extends State<Example> with TickerProviderStateMixin {
  late AnimationController _controller;
  late Animation<double> _animation;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: const Duration(milliseconds: 300),
      vsync: this,
    );
    _animation = Tween<double>(
      begin: 0.0,
      end: 1.0,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Curves.easeInOut,
    ));
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }
}
```

## デバッグ方法

### ログ出力
```dart
import 'dart:developer' as developer;

// デバッグログ
developer.log('Debug message', name: 'MyApp');

// エラーログ
developer.log('Error occurred', error: error, stackTrace: stackTrace);
```

### ホットリロード
```bash
# ホットリロード
r

# ホットリスタート
R

# ウィジェット再構築
w
```

### デバッグツール
- **Flutter Inspector**: ウィジェットツリーの確認
- **Performance**: パフォーマンスの測定
- **Memory**: メモリ使用量の確認

## テスト

### 単体テスト
```dart
import 'package:flutter_test/flutter_test.dart';

void main() {
  group('ExampleWidget Tests', () {
    testWidgets('should display correct text', (WidgetTester tester) async {
      await tester.pumpWidget(const ExampleWidget());
      expect(find.text('Expected Text'), findsOneWidget);
    });
  });
}
```

### テスト実行
```bash
# 全テスト実行
flutter test

# 特定のテスト実行
flutter test test/widget_test.dart
```

## パフォーマンス最適化

### メモリ管理
- **dispose()**: リソースの適切な解放
- **const**: 不変ウィジェットの使用
- **ListView.builder**: 大量データの効率的な表示

### アニメーション最適化
- **TickerProviderStateMixin**: 適切なvsyncの使用
- **CurvedAnimation**: 自然なアニメーションカーブ
- **AnimatedBuilder**: 必要な部分のみ再構築

## デプロイ

### リリースビルド
```bash
# Android APK
flutter build apk --release

# iOS IPA
flutter build ios --release
```

### アプリサイズ最適化
```bash
# アプリサイズ分析
flutter build apk --analyze-size
```

## トラブルシューティング

### よくある問題
1. **ホットリロードが効かない**: ファイルの保存を確認
2. **アニメーションが重い**: TickerProviderStateMixinの確認
3. **メモリリーク**: dispose()の実装確認

### エラー対処
- **BuildContext使用エラー**: contextの有効性確認
- **Null Safetyエラー**: nullチェックの追加
- **依存関係エラー**: pubspec.yamlの確認

## Git運用

### ブランチ戦略
- **main**: 本番環境
- **develop**: 開発環境
- **feature/**: 機能開発ブランチ

### コミットメッセージ
```
feat: 新機能の追加
fix: バグ修正
docs: ドキュメント更新
style: コードスタイル修正
refactor: リファクタリング
test: テスト追加
chore: その他の変更
```

## 参考資料

- [Flutter公式ドキュメント](https://flutter.dev/docs)
- [Dart公式ドキュメント](https://dart.dev/guides)
- [Provider公式ドキュメント](https://pub.dev/packages/provider)
